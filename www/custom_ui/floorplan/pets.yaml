page_id: Pets
image: /local/custom_ui/floorplan/pets.svg
stylesheet: /local/custom_ui/floorplan/pets.css
warnings:

variables:
  - name: floorplan.hours
  - name: floorplan.minutes

defaults:
  hover_over: true
  more_info: true

rules:
  # - element: floorplan.clock_button
  #   action:
  #     service: floorplan.page_navigate
  #     data:
  #       page_id: clock_config

  - entities:
      - sensor.dogfed_time
      - sensor.catfed_time
      - sensor.dogwalked_time
      - sensor.pigfed_time
      - sensor.fishfed_time
    class_template: '
      if( Date.parse( entity.state  ) > (Date.now() - 6*60*60*1000 )  ) {
        return "chore-done";
      } else {
        return "chore-waiting";
      }
    '
    action:
      service: mqtt.publish
      data_template: >
        {
          "topic": "pets/${ entity.attributes.friendly_name  }",
          "payload": "${ new Date().toJSON()  }",
          "retain": true
        }

  - elements:
      - reset
    action:
      - service: mqtt.publish
        data:
          topic: "pets/dogfed"
          retain: true
          payload: null
      - service: mqtt.publish
        data:
          topic: "pets/catfed"
          retain: true
          payload: null
      - service: mqtt.publish
        data:
          topic: "pets/dogwalked"
          retain: true
          payload: null
